<html>
<body>
    <div>
        <input type="text" value="Говорите сюда" id="message" />
        <button onclick="sendMessage();">Возглас</button>
    </div>
    <div>
        <textarea id="history" cols="80" rows="20" readonly>11</textarea>
    </div>

    <script src="//cdnjs.cloudflare.com/ajax/libs/socket.io/1.3.6/socket.io.min.js"></script>
    <script>
        var socket = io.connect('http://' + document.domain + ':' + location.port);
        var userID = getParameterByName('username');

        function getParameterByName(name) {
            // get params from URL/Address-line
            name = name.replace(/[\[]/, "\\\[").replace(/[\]]/, "\\\]");
            var regexS = "[\\?&]" + name + "=([^&#]*)";
            var regex = new RegExp(regexS);
            var results = regex.exec(window.location.search);
            if (results == null)
                return "";
            else
                return decodeURIComponent(results[1].replace(/\+/g, " "));
        }

        function sendMessage() {
            message = document.getElementById('message').value;
            socket.emit('sendMessage', {'id': userID, 'msg': message});
            addNewLineToTextarea('Вы: ' + message);
        }

        function getMessages() {
            socket.emit('getMessages', userID);
        }

        function addNewLineToTextarea(text) {
            textarea = document.getElementById('history');
            textarea.value = text + '\n' + textarea.value;
        }

        socket.on('connect', function () {
            socket.emit('startGame', userID);
        });

        socket.on('sendMessage', function () {
            getMessages();
        })

        socket.on('getMessages', function (data) {
            console.log(data);
            messages = JSON.parse(data);
            for (var i = 0; i < messages.length; i++)
                addNewLineToTextarea(messages[i].Message.From + ': ' + messages[i].Message.Text);
        });
    </script>
</body>
</html>